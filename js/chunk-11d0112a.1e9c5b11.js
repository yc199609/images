(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-11d0112a"],{"0baa":function(e,t,a){"use strict";var n=a("1834"),i=a.n(n);i.a},1834:function(e,t,a){},"3a44":function(e,t,a){},"3d63":function(e,t,a){"use strict";var n=a("b920"),i=a.n(n);i.a},"53fc":function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return s})),a.d(t,"f",(function(){return l})),a.d(t,"b",(function(){return r})),a.d(t,"e",(function(){return c})),a.d(t,"d",(function(){return d}));var n=a("b775"),i={GetAll:"/api/company/Role/GetAll",GetById:"/api/company/Role/GetById",Create:"/api/company/Role/Create",deleteRole:"/api/company/Role/delete",GetAllFunction:"/api/Operation/Function/GetAllDmsFuncs",UpdateRoleRights:"/api/Company/Role/UpdateRoleRights",SaveRoleRights:"/api/company/Role/SaveRoleRights"};function o(){return Object(n["a"])({url:i.GetAll,method:"get",headers:{"Content-Type":"application/json"}})}function s(e){return Object(n["a"])({url:i.GetById,method:"get",headers:{"Content-Type":"application/json"},params:{id:e}})}function l(e){return Object(n["a"])({url:i.deleteRole,method:"post",headers:{"Content-Type":"application/json"},data:{id:e}})}function r(){return Object(n["a"])({url:i.GetAllFunction,method:"get"})}function c(e){return Object(n["a"])({url:i.UpdateRoleRights,method:"post",headers:{"Content-Type":"application/json"},data:e})}function d(e){return Object(n["a"])({url:i.SaveRoleRights,method:"post",headers:{"Content-Type":"application/json"},data:e})}},a9f9:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("Search",{staticClass:"search",attrs:{"show-btn":e.buttonPermissions("300010101"),onsubmit:"return false"},on:{search:e.searchInit,changeKeyword:e.changeKeyword}},[e.buttonPermissions("300010102")?n("el-button",{attrs:{type:"warning",plain:"",size:"small",icon:"el-icon-plus"},on:{click:e.insert}},[e._v(e._s(e.$t("employees.created")))]):e._e()],1),e.buttonPermissions("300010110")?n("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"/api/company/Employee/UploadEmployee",limit:1,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"file-list":e.fileList,"auto-upload":!1,"http-request":e.uploadFile}},[n("el-link",{attrs:{slot:"tip",size:"small",type:"primary",plain:"",icon:"el-icon-download",href:e.href},on:{click:e.downTemplate},slot:"tip"},[e._v("下载模版")]),n("el-button",{attrs:{slot:"trigger",size:"small",type:"primary",plain:"",icon:"el-icon-folder-opened"},on:{click:e.choose},slot:"trigger"},[e._v("选取文件")]),n("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success",plain:"",icon:"el-icon-upload2"},on:{click:e.submitUpload}},[e._v("批量导入员工")]),n("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("请先下载模版再批量导入员工, 模版格式为Excel")])],1):e._e(),n("el-tabs",{staticClass:"roleTabs",on:{"tab-click":e.handleTabChange},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.roles,(function(e,t){return n("el-tab-pane",{key:t,attrs:{label:e.name,name:e.name,data:e}})})),1),n("el-card",[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"table",attrs:{data:e.tableData,border:""}},[n("template",{slot:"empty"},[n("div",{staticClass:"empty"},[n("img",{attrs:{src:a("a431")}}),n("p",[e._v("暂无数据")])])]),n("el-table-column",{attrs:{label:e.$t("employees.name"),align:"center",prop:"name"}}),n("el-table-column",{attrs:{label:e.$t("employees.gender"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.sex?n("el-tag",{attrs:{type:"danger"}},[e._v(e._s(e.$t("employees.female")))]):n("el-tag",{attrs:{type:"primary"}},[e._v(e._s(e.$t("employees.male")))])]}}])}),n("el-table-column",{attrs:{label:e.$t("employees.number"),align:"center",prop:"mobile"}}),e.buttonPermissions("300010103")||e.buttonPermissions("300010104")?n("el-table-column",{attrs:{label:e.$t("employees.operation"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.buttonPermissions("300010103")?n("el-button",{attrs:{type:"text",icon:"el-icon-edit-outline"},on:{click:function(a){return e.edit(t.row.id)}}},[e._v(e._s(e.$t("employees.edit")))]):e._e(),e.buttonPermissions("300010107")?n("el-button",{attrs:{type:"text",icon:"el-icon-user"},on:{click:function(a){return e.bindEmploy(t.row.id)}}},[e._v("所绑设备")]):e._e(),e.buttonPermissions("300010104")?n("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.del(t.row.id)}}},[e._v(e._s(e.$t("employees.delete")))]):e._e()]}}],null,!1,1629203592)}):e._e()],2)],1),n("div",{staticClass:"paginationContainer"},[n("el-pagination",{attrs:{"current-page":e.pageIndex,"page-sizes":[10,20,30,40,50],"page-size":e.pageSize,total:e.totalCount,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e.detailShow?n("Detail",{ref:"detail",on:{reload:e.editHidden}}):e._e(),n("BindEmploy",{ref:"bindEmploy"})],1)},i=[],o=(a("28a5"),a("7f7f"),a("53fc")),s=a("1427"),l=a("c59c"),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{"append-to-body":!0,"modal-append-to-body":!1,visible:e.visible,"close-on-click-modal":!1,title:"insert"===e.mode?this.$t("employees.details.created"):this.$t("employees.details.modify")},on:{"update:visible":function(t){e.visible=t},close:e.onClose}},[a("el-card",{attrs:{shadow:"hover"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("信息")])]),a("el-form",{ref:"form",staticClass:"form",attrs:{model:e.form,rules:e.rules}},[a("el-row",{staticClass:"mt20"},[a("el-col",{attrs:{offset:1,span:9}},[a("el-form-item",{attrs:{label:e.$t("employees.details.baseInfo.realName"),prop:"name"}},[a("el-input",{attrs:{maxlength:50},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),a("el-col",{attrs:{offset:3,span:9}},[a("el-form-item",{attrs:{label:e.$t("employees.details.baseInfo.number"),prop:"mobile"}},[a("el-input",{attrs:{disabled:"edit"===e.mode,maxlength:50},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1)],1)],1),a("el-row",{staticClass:"mt20"},[a("el-col",{attrs:{offset:1,span:15}},[a("el-form-item",{attrs:{label:e.$t("employees.details.baseInfo.email"),prop:"email"}},[a("el-input",{attrs:{maxlength:100},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1)],1)],1),a("el-row",{staticClass:"mt20"},[a("el-col",{attrs:{offset:1,span:9}},[a("el-form-item",{attrs:{label:e.$t("employees.details.baseInfo.nickName"),prop:"nickName"}},[a("el-input",{attrs:{maxlength:50},model:{value:e.form.nickName,callback:function(t){e.$set(e.form,"nickName",t)},expression:"form.nickName"}})],1)],1),a("el-col",{attrs:{offset:3,span:9}},[a("el-form-item",{attrs:{label:e.$t("employees.details.baseInfo.simplicity"),prop:"pinYing"}},[a("el-input",{attrs:{maxlength:50},model:{value:e.form.pinYing,callback:function(t){e.$set(e.form,"pinYing",t)},expression:"form.pinYing"}})],1)],1)],1),a("el-row",{staticClass:"mt20"},[a("el-col",{attrs:{offset:1,span:9}},[a("el-form-item",{attrs:{label:e.$t("employees.details.baseInfo.gender"),prop:"sex"}},[a("el-select",{attrs:{placeholder:e.$t("employees.details.baseInfo.chooseGender")},model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}},[a("el-option",{attrs:{value:0,label:e.$t("employees.details.baseInfo.female")}}),a("el-option",{attrs:{value:1,label:e.$t("employees.details.baseInfo.male")}})],1)],1)],1),a("el-col",{attrs:{offset:3,span:9}},[a("el-form-item",{attrs:{label:e.$t("employees.details.baseInfo.birthday"),prop:"birthday"}},[a("el-date-picker",{attrs:{placeholder:e.$t("employees.details.baseInfo.chooseDate"),type:"date"},model:{value:e.form.birthday,callback:function(t){e.$set(e.form,"birthday",t)},expression:"form.birthday"}})],1)],1)],1),a("el-row",{staticClass:"mt20"},[a("el-col",{attrs:{offset:1,span:22}},[a("el-form-item",{attrs:{label:e.$t("employees.details.baseInfo.remark"),prop:"remark"}},[a("el-input",{attrs:{maxlength:150,type:"textarea"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1)],1)],1),e.buttonPermissions("300010105")?a("el-card",[a("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(e._s(e.$t("employees.details.power.role")))])]),a("el-radio-group",{staticClass:"clearfix",on:{change:e.handleCheckedRole},model:{value:e.checkedRoles,callback:function(t){e.checkedRoles=t},expression:"checkedRoles"}},e._l(e.roles,(function(t){return a("el-radio",{key:t.id,staticClass:"checkbox",attrs:{label:t.id}},[e._v(e._s(t.name))])})),1)],1):e._e(),a("div",{staticStyle:{"text-align":"center","margin-top":"10px"}},[a("el-button",{staticClass:"mr10px",attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v(e._s("insert"===e.mode?"新增":e.$t("employees.details.baseInfo.modify")))])],1)],1)},c=[],d=(a("8e6e"),a("456d"),a("96cf"),a("3b8d")),p=a("bd86"),m=(a("ac6a"),a("4624")),u=a("61f7");function h(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function f(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(a,!0).forEach((function(t){Object(p["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var b={mixins:[m["a"]],data:function(){return{form:{birthday:""},rules:{name:[{type:"string",required:!0,message:this.$t("employees.details.baseInfo.rules.name"),trigger:"blur"}],nickName:[{required:!0,message:this.$t("employees.details.baseInfo.rules.nickName"),trigger:"blur"}],pinYing:[{required:!0,message:this.$t("employees.details.baseInfo.rules.simplicity"),trigger:"blur"}],mobile:[{type:"number",required:!0,validator:u["c"],trigger:"blur"},{min:11,message:"不能小于11位数手机号",trigger:"blur"}],email:[{required:!0,type:"string",validator:u["b"],trigger:"blur"}],sex:[{required:!0,message:this.$t("employees.details.baseInfo.rules.gender"),trigger:"change"}],birthday:[{required:!0,message:this.$t("employees.details.baseInfo.rules.birthday"),trigger:"change"}],remark:[{required:!0,message:this.$t("employees.details.baseInfo.rules.remark"),trigger:"blur"}]},visible:!1,mode:"insert",id:"",checkAll:!1,checkedRoles:null,roles:[]}},methods:{onSubmit:function(){var e=this,t=this.checkedRoles;t||this.roles.forEach((function(e){"cUser"===e.code&&(t=e.id)})),this.$refs.form.validate((function(a){if(a){var n;n=e.form.birthday?e.$moment(e.form.birthday).utc().format():"";var i=f({},e.form,{birthday:n,roleIds:[t]});switch(e.mode){case"insert":Object(l["a"])(i).then((function(){e.$message({type:"success",message:e.$t("rules.newsuccess"),duration:500,onClose:function(){e.visible=!1}})}));break;case"edit":Object(l["h"])(i).then((function(){e.$message({type:"success",message:e.$t("rules.successfulRevision"),duration:500,onClose:function(){e.visible=!1}})}));break}}}))},init:function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(t){var a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getAllPower();case 2:this.id=t,"undefined"===typeof t?(this.mode="insert",this.roles.forEach((function(e){"cUser"===e.code&&(a.checkedRoles=e.id)})),this.visible=!0):Object(l["c"])(t).then((function(e){var t="",n=f({},e.data);n.departmentIds=[],n&&n.birthday&&(t=a.$moment.utc(n.birthday).local().format()),a.$set(a,"form",f({},n,{birthday:t}));var i=n.roles[0].id;a.$nextTick((function(){a.$set(a,"checkedRoles",i)})),a.visible=!0,a.mode="edit"}));case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),onClose:function(){this.$emit("reload")},handleCheckAll:function(){this.checkAll?this.checkedRoles=[]:this.checkedRoles=(this.roles||[]).map((function(e){return e.id})),this.checkAll=!this.checkAll},handleCheckedRole:function(e){var t=e.length;this.checkAll=t===this.roles.length},getAllPower:function(){var e=this;return new Promise((function(t){Object(o["a"])().then((function(a){e.$set(e,"roles",a.data),t()}))}))}}},y=b,g=(a("ef8f"),a("2877")),v=Object(g["a"])(y,r,c,!1,null,"9e138b8e",null),k=v.exports,C=a("b775"),x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{"append-to-body":!0,"modal-append-to-body":!1,visible:e.visible,"close-on-click-modal":!1,title:"绑定员工"},on:{"update:visible":function(t){e.visible=t},close:e.onClose}},[a("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-thumb"},on:{click:e.chooseDevice}},[e._v("选择设备")]),a("div",{staticStyle:{"margin-top":"10px"}},e._l(e.tags,(function(t){return a("el-tag",{key:t.id,staticStyle:{margin:"3px 5px"},attrs:{label:t.name,closable:!0},on:{close:function(a){return e.handleClose(t)}}},[e._v("\n      "+e._s(t.name)+"\n    ")])})),1),a("div",{staticStyle:{"text-align":"center","margin-top":"10px"}},[a("el-button",{staticClass:"mr10px",attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确定")])],1),a("el-dialog",{attrs:{"append-to-body":!0,"modal-append-to-body":!1,visible:e.choosevisible,"close-on-click-modal":!1,title:"选择设备"},on:{"update:visible":function(t){e.choosevisible=t},close:e.onClose}},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),a("el-checkbox-group",{on:{change:e.handleCheckedCitiesChange},model:{value:e.checkDevice,callback:function(t){e.checkDevice=t},expression:"checkDevice"}},e._l(e.checkList,(function(t){return a("el-checkbox",{key:t.id,attrs:{label:t}},[e._v(e._s(t.name))])})),1),a("div",{staticStyle:{"text-align":"center","margin-top":"10px"}},[a("el-button",{staticClass:"mr10px",attrs:{type:"primary"},on:{click:e.deviceSubmit}},[e._v("保存")])],1)],1)],1)},$=[],w=a("11e6"),j={name:"BindEmploy",data:function(){return{visible:!1,choosevisible:!1,emploeeId:"",checkDevice:[],checkList:[],tags:[],checkAll:!1,isIndeterminate:!0}},methods:{init:function(e){var t=this;this.emploeeId=e,this.visible=!0,Object(l["d"])({employeeId:e}).then((function(e){t.tags=e.data}))},handleClose:function(e){this.tags.splice(this.tags.indexOf(e),1)},handleCheckAllChange:function(e){this.checkDevice=e?this.checkList:[],this.isIndeterminate=!1},handleCheckedCitiesChange:function(e){var t=e.length;this.checkAll=t===this.tags.length,this.isIndeterminate=t>0&&t<this.tags.length},chooseDevice:function(){var e=this;this.choosevisible=!0,Object(w["o"])({pageIndex:1,pageSize:1e3}).then((function(t){for(var a in e.checkList=t.data.items,e.checkDevice=e.tags,e.checkDevice)for(var n in e.checkList)e.checkDevice[a].name===e.checkList[n].name&&(e.checkDevice[a]=e.checkList[n])}))},onClose:function(){},deviceSubmit:function(){this.choosevisible=!1,this.tags=this.checkDevice},onSubmit:function(){var e=this,t=[];this.tags.map((function(e){t.push(e.id)})),Object(l["g"])({emploeeId:this.emploeeId,deviceIds:t}).then((function(){e.$message({type:"success",message:"绑定成功",duration:500,onClose:function(){e.visible=!1}})}))}}},I=j,_=Object(g["a"])(I,x,$,!1,null,"11710217",null),O=_.exports,E={name:"Employees",components:{Search:s["a"],Detail:k,BindEmploy:O},mixins:[m["d"],m["c"],m["a"]],data:function(){return{loading:!1,activeName:"",tableData:[],detailShow:!1,pageSize:10,roles:[],code:null,fileList:[],href:"",fileData:null,flag:!0,fileFlag:""}},mounted:function(){var e=this;Object(o["a"])().then((function(t){e.$set(e,"roles",t.data),e.activeName=t.data[0].name,e.code=t.data[0].id,e.init()}))},methods:{choose:function(){},uploadFile:function(e){this.fileFlag=e;var t=e.file.name.split(".")[e.file.name.split(".").length-1];"xls"===t||"xlsx"===t?(this.fileData.append("files",e.file),this.flag=!0):(this.$message.error("上传文件只能是Excel格式!"),this.flag=!1)},bindEmploy:function(e){this.$refs.bindEmploy.init(e)},submitUpload:function(){var e=this;this.$set(this,"fileData",new FormData),this.$refs.upload.submit(),""===this.fileFlag?this.$message({message:"请先选择要导入的文件",type:"warning"}):this.flag&&Object(C["a"])({url:"/api/company/Employee/UploadEmployee",method:"post",headers:{"Content-Type":"application/json"},data:this.fileData}).then((function(){e.$message({type:"success",message:"导入成功",duration:500,onClose:function(){e.visible=!1}})})),this.fileData=null,this.$refs.upload.clearFiles()},handleRemove:function(e,t){0===t.length&&(this.fileFlag="")},handlePreview:function(){},downTemplate:function(){this.href="/api/company/Employee/ExportExcel"},handleTabChange:function(e){this.code=e.$attrs.data.id,this.init()},init:function(){var e=this;this.loading=!0,Object(l["f"])({name:this.keyword,pageIndex:this.pageIndex,pageSize:this.pageSize,code:this.code}).then((function(t){e.loading=!1,e.$set(e,"tableData",t.data.items),e.totalCount=t.data.totalCount,e.pageIndex=t.data.pageIndex,e.pageSize=t.data.pageSize}))},searchInit:function(){this.pageIndex=1,this.init()},insert:function(){var e=this;this.detailShow=!0,this.$nextTick((function(){e.$refs.detail.init()}))},edit:function(e){var t=this;this.detailShow=!0,this.$nextTick((function(){t.$refs.detail.init(e)}))},editHidden:function(){this.detailShow=!1,this.init()},del:function(e){var t=this;this.$confirm("此操作将删除该员工, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(l["b"])(e).then((function(){t.$message({type:"success",message:"删除成功",duration:500,onClose:function(){t.searchInit()}})}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))}}},R=E,D=(a("0baa"),a("3d63"),Object(g["a"])(R,n,i,!1,null,"2bf622a9",null));t["default"]=D.exports},b920:function(e,t,a){},c59c:function(e,t,a){"use strict";a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return s})),a.d(t,"h",(function(){return l})),a.d(t,"b",(function(){return r})),a.d(t,"f",(function(){return c})),a.d(t,"e",(function(){return d})),a.d(t,"d",(function(){return p})),a.d(t,"g",(function(){return m}));var n=a("b775"),i={GetById:"/api/Company/Employee/GetById",Create:"/api/Company/Employee/create",UpdateInfo:"/api/company/Employee/UpdateInfo",GetEmployeesByName:"/api/Company/Employee/GetEmployeesByName",DeleteEmployee:"/api/Company/Employee/delete",GetEmployeesBellowRoleLevel:"/api/company/employee/GetEmployeesBellowRoleLevel",UploadEmployee:"/api/company/Employee/UploadEmployee",GetDevicesByEmpId:"/api/dms/Device/GetDevicesByEmpId",UpdateByDeviceRefEmploee:"/api/dms/Device/UpdateByDeviceRefEmploee"};function o(e){return Object(n["a"])({url:i.GetById,method:"get",headers:{"Content-Type":"application/json"},params:{id:e}})}function s(e){return Object(n["a"])({url:i.Create,method:"post",headers:{"Content-Type":"application/json"},data:e})}function l(e){return Object(n["a"])({url:i.UpdateInfo,method:"post",headers:{"Content-Type":"application/json"},data:e})}function r(e){return Object(n["a"])({url:i.DeleteEmployee,method:"post",headers:{"Content-Type":"application/json"},data:{id:e}})}function c(e){return Object(n["a"])({url:i.GetEmployeesByName,method:"get",headers:{"Content-Type":"application/json"},params:e})}function d(e){return Object(n["a"])({url:i.GetEmployeesBellowRoleLevel,method:"get",headers:{"Content-Type":"application/json"},params:e})}function p(e){return Object(n["a"])({url:i.GetDevicesByEmpId,method:"get",params:e})}function m(e){return Object(n["a"])({url:i.UpdateByDeviceRefEmploee,method:"post",headers:{"Content-Type":"application/json"},data:e})}},ef8f:function(e,t,a){"use strict";var n=a("3a44"),i=a.n(n);i.a}}]);
//# sourceMappingURL=chunk-11d0112a.1e9c5b11.js.map