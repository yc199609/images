(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0fbcd840"],{"12a9":function(e,t,i){},1638:function(e,t,i){"use strict";var n=i("a2fa"),o=i.n(n);o.a},"221e":function(e,t,i){},"2e24":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{visible:e.childvisible,"append-to-body":!0,"close-on-click-modal":!1,"modal-append-to-body":!1,title:e.$t("list.child.devices")},on:{"update:visible":function(t){e.childvisible=t},close:e.onchildClose}},[n("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:e.tableData,border:""},on:{select:e.handleChoose,"select-all":e.handleChooseAll}},[n("template",{slot:"empty"},[n("div",{staticClass:"empty"},[n("img",{attrs:{src:i("a431")}}),n("p",[e._v("暂无数据")])])]),n("el-table-column",{attrs:{type:"selection",width:"40"}}),n("el-table-column",{attrs:{label:e.$t("list.child.code"),align:"center",prop:"code"}}),n("el-table-column",{attrs:{label:e.$t("list.child.name"),align:"center",prop:"name"}}),n("el-table-column",{attrs:{label:e.$t("list.child.type"),align:"center",prop:"typeName"}})],2),n("div",{staticClass:"paginationContainer"},[n("el-pagination",{attrs:{"current-page":e.pageIndex,"page-sizes":[10,20,30,40,50,100],"page-size":e.pageSize,total:e.totalCount,layout:"total, prev, pager, next, jumper"},on:{"current-change":e.handleCurrentChange}})],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.childvisible=!1}}},[e._v(e._s(e.$t("cancel")))]),n("el-button",{attrs:{type:"primary"},on:{click:e.chooseChild}},[e._v(e._s(e.$t("ok")))])],1)],1)},o=[],a=(i("7f7f"),i("ac6a"),i("20d6"),i("6762"),i("2fdb"),i("11e6")),s={name:"Child",props:["checkedData"],data:function(){return{childvisible:!1,tableData:[],pageIndex:1,pageSize:10,totalCount:30,chooseArray:[]}},created:function(){var e=(this.checkedData||[]).map((function(e){return{id:e.deviceId,name:e.deviceName,code:e.deviceCode,relCode:e.code}}));this.chooseArray=e},methods:{handleChooseAll:function(e){var t=this,i=this.chooseArray.map((function(e){return e.id}));if(e.length>0){var n=e.filter((function(e){return!i.includes(e.id)}));this.chooseArray=this.chooseArray.concat(n)}else this.chooseArray=this.chooseArray.filter((function(e){return!t.tableData.map((function(e){return e.id})).includes(e.id)}))},handleChoose:function(e,t){var i=e.some((function(e){return e.id===t.id}));if(i){var n=this.chooseArray.some((function(e){return e.id===t.id}));n||this.chooseArray.push(t)}else{var o=this.chooseArray.findIndex((function(e){return e.id===t.id}));this.chooseArray.splice(o,1)}},onchildClose:function(){this.$emit("hidden")},handleCurrentChange:function(e){this.pageIndex=e,this.init()},toggleSelection:function(e){var t=this,i=this.tableData.filter((function(t){return e.map((function(e){return e.id})).includes(t.id)}));i.forEach((function(e){t.$nextTick((function(){t.$refs.multipleTable.toggleRowSelection(e,!0)}))}))},init:function(){var e=this;this.childvisible=!0,Object(a["o"])({pageIndex:this.pageIndex,pageSize:this.pageSize}).then((function(t){e.$set(e,"tableData",t.data.items),e.totalCount=t.data.totalCount,e.pageIndex=t.data.pageIndex,e.pageSize=t.data.pageSize,e.toggleSelection(e.chooseArray)}))},chooseChild:function(){var e=this.chooseArray.map((function(e){return{deviceId:e.id,deviceName:e.name,deviceCode:e.code,code:e.relCode}}));this.$emit("childDe",e),this.childvisible=!1}}},r=s,l=(i("a645"),i("2877")),c=Object(l["a"])(r,n,o,!1,null,"58a6447c",null);t["a"]=c.exports},"579c":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-form-item",{attrs:{label:this.$t("list.details.baseInfomation.position"),prop:"valuePosition"}},[i("el-dropdown",{staticStyle:{width:"79%"},attrs:{"hide-on-click":!1,placement:"top",trigger:"click"}},[i("el-input",{staticClass:"el-dropdown-link",attrs:{id:"tipinput","suffix-icon":"el-icon-location"},on:{focus:e.getAddress},model:{value:e.valuePosition,callback:function(t){e.valuePosition=t},expression:"valuePosition"}}),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{staticClass:"dropdown",attrs:{command:"a"}},[i("div",{attrs:{id:"leftBox"}}),i("div",{ref:"container",staticClass:"container"})])],1)],1)],1)},o=[],a=(i("7f7f"),i("386d"),{name:"Position",props:["formAddress"],data:function(){return{valuePosition:"",marker:null,map:null,lng:"",lat:"",mapClickFn:!1,address:null}},methods:{getAddress:function(){this.initMap(),this.mapTip(),this.mapClick()},mapClick:function(){var e=this;this.mapClickFn||(this.mapClickFn=!0,this.map.on("click",(function(t){e.lng=t.lnglat.lng,e.lat=t.lnglat.lat,e.positionMthods([e.lng,e.lat]),e.marker&&e.map.remove(e.marker),e.marker=new AMap.Marker({position:new AMap.LngLat(e.lng,e.lat)}),e.map.add(e.marker)})))},initMap:function(){this.map||(this.map=new AMap.Map(this.$refs.container,{resizeEnable:!0,zoom:12,center:[116.397428,39.90923]}))},mapTip:function(){var e=this,t={city:"",input:"tipinput",output:"leftBox"};this.map.plugin(["AMap.Autocomplete","AMap.PlaceSearch"],(function(){var i=new AMap.Autocomplete(t),n=new AMap.PlaceSearch({map:e.map});function o(e){n.setCity(e.poi.adcode),n.search(e.poi.name)}AMap.event.addListener(i,"select",o),e.mapClick(),AMap.event.addListener(n,"markerClick",(function(t){e.valuePosition=t.data.name}))}))},positionMthods:function(e){var t=this;"string"==typeof e?this.valuePosition=e:AMap.plugin("AMap.Geocoder",(function(){var i=new AMap.Geocoder({city:"全国"});i.getAddress(e,(function(e,i){if("complete"===e&&"OK"===i.info){var n={province:i.regeocode.addressComponent.province,city:i.regeocode.addressComponent.city};t.$set(t,"address",n),t.valuePosition=i.regeocode.formattedAddress}}))}))}}}),s=a,r=(i("ad16"),i("2877")),l=Object(r["a"])(s,n,o,!1,null,"630ed954",null);t["a"]=l.exports},"7d10":function(e,t,i){"use strict";var n=i("9960"),o=i.n(n);o.a},9960:function(e,t,i){},a2fa:function(e,t,i){},a645:function(e,t,i){"use strict";var n=i("12a9"),o=i.n(n);o.a},ad16:function(e,t,i){"use strict";var n=i("221e"),o=i.n(n);o.a},f2d6:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[e.buttonPermissions("300020801")?n("el-card",{staticStyle:{"margin-bottom":"12px"}},[n("el-button",{attrs:{type:"warning",plain:"",size:"small",icon:"el-icon-plus"},on:{click:e.insert}},[e._v(e._s(e.$t("list.created")))])],1):e._e(),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:e.groupData,"row-key":"id",border:"","tree-props":{children:"children",hasChildren:"hasChildren"}}},[n("template",{slot:"empty"},[n("div",{staticClass:"empty"},[n("img",{attrs:{src:i("a431")}}),n("p",[e._v("暂无数据")])])]),n("el-table-column",{attrs:{label:"机构名",prop:"groupName"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("router-link",{attrs:{to:"list/"+t.row.id}},[n("el-link",[e._v(e._s(t.row.groupName))])],1)]}}])}),n("el-table-column",{attrs:{label:"代号",prop:"code"}}),n("el-table-column",{attrs:{label:"备注",prop:"remark"}}),e.buttonPermissions("300020802")||e.buttonPermissions("300020805")?n("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticStyle:{display:"flex","justify-content":"space-around","align-items":"center"}},[e.buttonPermissions("300020802")?n("el-button",{attrs:{type:"text",icon:"el-icon-edit-outline"},on:{click:function(i){return e.handleClick(t.row)}}},[e._v("编辑")]):e._e(),e.buttonPermissions("300020805")?n("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(i){return e.del(t.row.id)}}},[e._v(e._s(e.$t("list.delete")))]):e._e()],1)]}}],null,!1,3236642989)}):e._e()],2),n("Details",{ref:"detail"})],1)},o=[],a=i("b775"),s={GetById:"/api/dms/Group/GetById",UpdateInfo:"/api/dms/Group/UpdateInfo",create:"/api/dms/Group/create",deviceDelete:"/api/dms/Group/delete",GetList:"/api/dms/Group/GetList",GetAll:"/api/dms/Group/GetAll"};function r(e){return Object(a["a"])({url:s.GetById,method:"get",params:e})}function l(e){return Object(a["a"])({url:s.UpdateInfo,method:"post",headers:{"Content-Type":"application/json"},data:e})}function c(e){return Object(a["a"])({url:s.create,method:"post",headers:{"Content-Type":"application/json"},data:e})}function d(e){return Object(a["a"])({url:s.deviceDelete,method:"post",headers:{"Content-Type":"application/json"},data:e})}function u(){return Object(a["a"])({url:s.GetAll,method:"get"})}var p=i("4624"),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{visible:e.visible,"close-on-click-modal":!1,title:"insert"===e.type?this.$t("list.details.created"):this.$t("list.details.modify"),width:"55%"},on:{"update:visible":function(t){e.visible=t},close:e.onClose}},[n("el-form",{ref:"form",attrs:{data:e.form,model:e.form,rules:e.rules,"label-position":"top","label-width":"80px"}},[n("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:this.$t("list.details.baseInfomation.basicInformation"),name:"first"}},[n("el-row",{attrs:{gutter:24}},[n("el-col",{attrs:{offset:1,span:9}},[n("el-form-item",{attrs:{label:"分组名",prop:"groupName"}},[n("el-input",{model:{value:e.form.groupName,callback:function(t){e.$set(e.form,"groupName",t)},expression:"form.groupName"}})],1)],1),n("el-col",{attrs:{offset:1,span:9}},[n("el-form-item",{attrs:{label:"代码",prop:"code"}},[n("el-input",{model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1)],1)],1),n("el-row",{attrs:{gutter:24}},[n("el-col",{attrs:{offset:1,span:9}},[n("el-form-item",{attrs:{label:"上级分组(不选为顶级)"}},[n("el-cascader",{attrs:{options:e.upperGroupName,props:e.parentProp,"show-all-levels":!1,clearable:""},on:{change:e.handleChange},model:{value:e.form.parentId,callback:function(t){e.$set(e.form,"parentId",t)},expression:"form.parentId"}})],1)],1),n("el-col",{attrs:{offset:1,span:9}},[n("el-form-item",{attrs:{label:"备注",prop:"remark"}},[n("el-input",{model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1),n("el-row",{attrs:{gutter:24}},[n("el-col",{attrs:{offset:1,span:24}},[n("Position",{ref:"position",attrs:{formAddress:e.form.address}})],1)],1),n("el-row",[n("el-col",{attrs:{offset:1,span:24}},[n("el-form-item",{attrs:{label:"所属行业"}},[e._l(e.form.industries,(function(t){return n("el-tag",{key:t.industryName,attrs:{closable:"","disable-transitions":!1},on:{close:function(i){return e.handleClose(t)}},model:{value:e.form.industries,callback:function(t){e.$set(e.form,"industries",t)},expression:"form.industries"}},[e._v("\n                "+e._s(t.industryName)+"\n                ")])})),e.inputVisible?n("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):n("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInput}},[e._v("+ 添加行业")])],2)],1)],1)],1),n("el-tab-pane",{attrs:{label:"绑定设备",name:"second"}},[n("div",{staticClass:"sonDevide"},[n("strong",[e._v("绑定设备")]),n("br"),n("el-table",{staticStyle:{width:"100%","margin-top":"5px"},attrs:{data:e.form.devices,border:""}},[n("template",{slot:"empty"},[n("div",{staticClass:"empty"},[n("img",{attrs:{src:i("a431")}}),n("p",[e._v("暂无数据")])])]),n("el-table-column",{attrs:{label:e.$t("list.details.sonDevide.deviceNo"),prop:"deviceCode"}}),n("el-table-column",{attrs:{label:e.$t("list.details.sonDevide.deviceName"),prop:"deviceName"}}),n("el-table-column",{attrs:{label:e.$t("list.details.sonDevide.operation")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[n("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.deleteRow(i,e.form.devices)}}},[e._v(e._s(e.$t("list.details.sonDevide.remove")))])]}}])})],2),n("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"success",size:"mini",plain:""},on:{click:e.addChild}},[e._v(e._s(e.$t("list.details.sonDevide.add")))])],1)])],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.cancel}},[e._v(e._s(e.$t("cancel")))]),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("form")}}},[e._v(e._s(e.$t("ok")))])],1),e.childShow?n("child",{ref:"childDetail",attrs:{"checked-data":e.form.devices},on:{childDe:e.childDe}}):e._e()],1)},m=[],h=i("75fc"),v=(i("7f7f"),i("7514"),i("024c")),g=i.n(v),b=i("2e24"),y=i("579c"),C={name:"Details",components:{child:b["a"],Position:y["a"]},data:function(){return{inputVisible:!1,inputValue:"",visible:!1,form:{devices:[],industries:[],address:""},activeName:"first",type:"insert",childShow:!1,rules:{code:[{required:!0,message:this.$t("list.details.baseInfomation.rules.number"),trigger:"blur"}],groupName:[{required:!0,message:this.$t("list.details.baseInfomation.rules.name"),trigger:"blur"}],remark:[{required:!0,message:this.$t("list.details.baseInfomation.rules.remark"),trigger:"blur"}]},upperGroupName:[],parentProp:{value:"id",label:"groupName",children:"children",checkStrictly:!0}}},created:function(){this.getAll()},methods:{getAll:function(){var e=this;u().then((function(t){e.upperGroupName=t.data}))},init:function(e){var t=this;this.type=null==e?"insert":"edit",this.visible=!0,e&&r({id:e}).then((function(e){t.form=e.data,t.$refs.position.positionMthods(t.form.address)})),this.getAll()},handleChange:function(e){if(e){var t=e.length;this.form.parentId=e[t-1]}},onClose:function(){this.$refs.form.resetFields(),this.form={},this.$refs.position.valuePosition="",this.activeName="first"},cancel:function(){this.visible=!1},handleClose:function(e){this.form.industries.splice(this.form.industries.indexOf(e),1);var t=this.form.industries.splice(this.form.industries.indexOf(e),1);this.$set(this.form,"industries",t)},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick((function(){e.$refs.saveTagInput.$refs.input.focus()}))},handleInputConfirm:function(){var e=this,t=this.inputValue,i=!0;if(this.form.industries||(this.form.industries=[]),t){if(this.form.industries.find((function(n){n.industryName==t&&(e.$message("该行业标签已存在"),i=!1)})),i){var n=this.form.industries.concat({industryName:t,code:t});this.$set(this.form,"industries",n)}this.inputVisible=!1,this.inputValue=""}},onSubmit:function(e){var t=this;g.a.plugin("AMap.Geocoder",(function(){var i=new g.a.Geocoder({});i.getLocation(t.$refs.position.valuePosition.trim(),(function(i,n){"complete"===i?(t.form.lng=n.geocodes[0].location.lng,t.form.lat=n.geocodes[0].location.lat,t.form.province=n.geocodes[0].addressComponent.province,t.form.city=n.geocodes[0].addressComponent.city,t.form.address=t.$refs.position.valuePosition,t.$refs[e].validate((function(e){e&&t.form.lng&&(t.form.industries&&t.form.industries.length>0?"edit"===t.type?l(t.form).then((function(){t.$message({type:"success",message:"修改成功",duration:500,onClose:function(){t.$parent.init(),t.getAll(),t.cancel()}})})):"insert"===t.type&&c(t.form).then((function(){t.$message({type:"success",message:"新增成功",duration:500,onClose:function(){t.$parent.init(),t.getAll(),t.cancel()}})})):t.$message({type:"warning",message:"请填写行业",duration:3e3}))}))):t.$message({type:"error",message:"未知的地理信息"})}))}))},childDe:function(e){var t=e.map((function(e){return void 0===e.deviceCode?{deviceCode:e.code,deviceName:e.name,deviceId:e.id,code:e.glCode}:e}));this.$set(this.form,"devices",Object(h["a"])(t)),this.childShow=!1},addChild:function(){var e=this;this.childShow=!0,this.$nextTick((function(){e.$refs.childDetail.init()}))},deleteRow:function(e,t){t.map((function(i,n){e.deviceId===i.deviceId&&t.splice(n,1)}))}}},k=C,$=(i("1638"),i("2877")),w=Object($["a"])(k,f,m,!1,null,"3de2ae29",null),x=w.exports,A={name:"Group",components:{Details:x},mixins:[p["d"],p["a"]],data:function(){return{groupData:[],loading:!1}},created:function(){this.init()},methods:{init:function(){var e=this;this.loading=!0,u().then((function(t){e.loading=!1,e.groupData=t.data}))},searchInit:function(){this.init()},changeKeyword:function(e){this.keyword=e},insert:function(){this.$refs.detail.init()},handleClick:function(e){this.$refs.detail.init(e.id)},del:function(e){var t=this;this.$confirm("此机构将永久被删除, 是否继续?",this.$t("tips"),{confirmButtonText:this.$t("ok"),cancelButtonText:this.$t("cancel"),type:"warning"}).then((function(){d({id:e}).then((function(){t.$message({type:"success",message:t.$t("rules.successfulDeletion"),duration:500,onClose:function(){t.pageIndex=1,t.init()}})})).catch((function(){t.$message({type:"info",message:t.$t("rules.canceledDeletion")})}))}))}}},_=A,I=(i("7d10"),Object($["a"])(_,n,o,!1,null,"77de3da4",null));t["default"]=I.exports}}]);
//# sourceMappingURL=chunk-0fbcd840.86370536.js.map